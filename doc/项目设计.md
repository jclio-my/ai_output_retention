### 1. 项目架构与技术栈

*   **框架:** Next.js 14+ (使用 App Router, `output: 'export'` 模式实现纯静态)
*   **语言:** JavaScript
*   **样式:** Tailwind CSS
*   **数据源:** 本地 Markdown 文件 (`/posts/*.md`)
*   **Markdown 解析:** `gray-matter` (解析元数据), `react-markdown` (渲染内容)
*   **部署:** Cloudflare Pages (连接 GitHub 仓库自动构建)

### 2. 目录结构

```text
ai_output_retention/
├── posts/                  # 存放你的 .md 文件
│   ├── article-1.md
│   └── article-2.md
├── public/                 # 静态资源
├── src/
│   ├── app/
│   │   ├── layout.js       # 全局布局 (Header, Footer, DarkMode)
│   │   ├── page.js         # 首页 (显示最新文章)
│   │   ├── list/
│   │   │   └── page.js     # 列表页 (瀑布流)
│   │   ├── posts/
│   │   │   └── [slug]/
│   │   │       └── page.js # 文章详情页 (点击列表跳转用)
│   │   └── globals.css     # Tailwind 引入
│   ├── components/
│   │   ├── ThemeToggle.js  # 暗黑模式切换按钮
│   │   └── MarkdownView.js # 文章渲染组件
│   └── lib/
│       └── posts.js        # 读取 Markdown 的工具函数
├── next.config.js          # 配置静态导出
├── tailwind.config.js      # 配置字体和颜色
└── package.json
```

### 3. 核心代码实现

#### Step 1: 初始化与配置

首先安装必要的依赖：
```bash
npx create-next-app@latest ai_output_retention
# 选择: No TS, Yes ESLint, Yes Tailwind, Yes src/, Yes App Router
cd ai_output_retention
npm install gray-matter react-markdown date-fns next-themes clsx lucide-react
```

**修改 `tailwind.config.js` (配置微软雅黑与深黑风格):**

```javascript
/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: 'class', // 启用手动切换
  content: [
    "./src/**/*.{js,jsx,mdx}",
  ],
  theme: {
    extend: {
      fontFamily: {
        // 强制使用微软雅黑
        sans: ['"Microsoft YaHei"', 'sans-serif'],
      },
      colors: {
        // 定义极简深黑
        ink: '#1a1a1a', 
      }
    },
  },
  plugins: [
    require('@tailwindcss/typography'), // 需要安装: npm install -D @tailwindcss/typography
  ],
};
```

**修改 `next.config.js` (适配 Cloudflare Pages):**

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export', // 关键：生成纯静态 HTML
  images: { unoptimized: true }, // 静态导出不支持 Next Image 优化
};

module.exports = nextConfig;
```

#### Step 2: Markdown 数据读取 (`src/lib/posts.js`)

```javascript
import fs from 'fs';
import path from 'path';
import matter from 'gray-matter';

const postsDirectory = path.join(process.cwd(), 'posts');

export function getSortedPostsData() {
  // 确保目录存在
  if (!fs.existsSync(postsDirectory)) return [];

  const fileNames = fs.readdirSync(postsDirectory);
  const allPostsData = fileNames.map((fileName) => {
    const id = fileName.replace(/\.md$/, '');
    const fullPath = path.join(postsDirectory, fileName);
    const fileContents = fs.readFileSync(fullPath, 'utf8');
    const matterResult = matter(fileContents);

    return {
      id,
      ...matterResult.data,
      content: matterResult.content, // 获取内容
      date: matterResult.data.date || new Date().toISOString(), // 建议在md里写date
    };
  });

  // 按日期降序
  return allPostsData.sort((a, b) => {
    if (a.date < b.date) return 1;
    else return -1;
  });
}

export function getPostData(id) {
  const fullPath = path.join(postsDirectory, `${id}.md`);
  const fileContents = fs.readFileSync(fullPath, 'utf8');
  const matterResult = matter(fileContents);

  return {
    id,
    ...matterResult.data,
    content: matterResult.content,
  };
}
```

#### Step 3: 组件开发

**暗色切换 `src/components/ThemeToggle.js`:**

```javascript
'use client';
import { useTheme } from 'next-themes';
import { useEffect, useState } from 'react';
import { Moon, Sun } from 'lucide-react';

export default function ThemeToggle() {
  const [mounted, setMounted] = useState(false);
  const { theme, setTheme } = useTheme();

  useEffect(() => setMounted(true), []);

  if (!mounted) return null;

  return (
    <button
      onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}
      className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-ink dark:text-gray-200"
    >
      {theme === 'dark' ? <Sun size={20} /> : <Moon size={20} />}
    </button>
  );
}
```

**全局布局 `src/app/layout.js`:**

```javascript
import './globals.css';
import { ThemeProvider } from './theme-provider'; // 需要创建一个简单的 client wrapper
import Link from 'next/link';
import ThemeToggle from '@/components/ThemeToggle';

// 需要新建 src/app/theme-provider.js 包含:
// 'use client'; import { ThemeProvider as NextThemesProvider } from "next-themes";
// export function ThemeProvider({ children, ...props }) { return <NextThemesProvider {...props}>{children}</NextThemesProvider>; }

export const metadata = {
  title: 'AI Output Retention',
  description: 'Retention of valuable AI outputs',
};

export default function RootLayout({ children }) {
  return (
    <html lang="zh-CN" suppressHydrationWarning>
      <body className="bg-white dark:bg-[#121212] transition-colors duration-300 min-h-screen flex flex-col">
        <ThemeProvider attribute="class" defaultTheme="system" enableSystem>
          
          {/* 顶部: 只有右侧切换 */}
          <header className="fixed top-0 right-0 p-4 z-50">
            <ThemeToggle />
          </header>

          {/* 主体内容 */}
          <main className="flex-grow w-full max-w-4xl mx-auto px-6 py-16">
            {children}
          </main>

          {/* 底部导航 */}
          <footer className="w-full py-8 pb-12 text-center space-y-4 bg-white/90 dark:bg-[#121212]/90 backdrop-blur-sm fixed bottom-0 left-0 border-t border-gray-100 dark:border-gray-800 z-40">
            {/* 第一行: 导航 */}
            <nav className="flex justify-center gap-8 text-ink dark:text-gray-300 font-medium">
              <Link href="/" className="hover:underline underline-offset-4 decoration-2">首页</Link>
              <Link href="/list" className="hover:underline underline-offset-4 decoration-2">列表</Link>
            </nav>
            {/* 第二行: 作者 */}
            <div className="text-sm text-gray-500 dark:text-gray-600 font-light">
              ©jclio
            </div>
          </footer>

        </ThemeProvider>
      </body>
    </html>
  );
}
```

#### Step 4: 页面实现

**首页 (最新文章) `src/app/page.js`:**

```javascript
import { getSortedPostsData } from '@/lib/posts';
import ReactMarkdown from 'react-markdown';

export default function Home() {
  const posts = getSortedPostsData();
  const latestPost = posts[0];

  if (!latestPost) {
    return <div className="text-center mt-20 text-ink dark:text-gray-200">暂无内容</div>;
  }

  return (
    <article className="prose prose-zinc dark:prose-invert max-w-none">
      <h1 className="text-3xl font-bold text-ink dark:text-white mb-8">
        {latestPost.title}
      </h1>
      <div className="text-ink dark:text-gray-300 leading-relaxed font-sans">
        <ReactMarkdown>{latestPost.content}</ReactMarkdown>
      </div>
    </article>
  );
}
```

**列表页 (瀑布流) `src/app/list/page.js`:**

```javascript
import { getSortedPostsData } from '@/lib/posts';
import Link from 'next/link';
import ReactMarkdown from 'react-markdown';

export default function ListPage() {
  const posts = getSortedPostsData();

  return (
    // 使用 CSS Columns 实现简易瀑布流
    <div className="columns-1 sm:columns-2 gap-6 space-y-6">
      {posts.map((post) => (
        <Link key={post.id} href={`/posts/${post.id}`} className="block break-inside-avoid">
          <div className="bg-gray-50 dark:bg-[#1e1e1e] p-6 rounded-sm hover:shadow-lg transition-shadow duration-300 border border-transparent dark:border-gray-800">
            <h2 className="text-xl font-bold text-ink dark:text-white mb-3">
              {post.title}
            </h2>
            {/* 摘要显示 (截取部分内容) */}
            <div className="text-sm text-gray-600 dark:text-gray-400 line-clamp-6">
              <ReactMarkdown>
                {post.content.slice(0, 200) + "..."}
              </ReactMarkdown>
            </div>
          </div>
        </Link>
      ))}
    </div>
  );
}
```

**文章详情页 `src/app/posts/[slug]/page.js`:**

```javascript
import { getSortedPostsData, getPostData } from '@/lib/posts';
import ReactMarkdown from 'react-markdown';

// 生成静态路径
export async function generateStaticParams() {
  const posts = getSortedPostsData();
  return posts.map((post) => ({
    slug: post.id,
  }));
}

export default function Post({ params }) {
  const post = getPostData(params.slug);

  return (
    <article className="prose prose-zinc dark:prose-invert max-w-none pb-24">
      <h1 className="text-3xl font-bold text-ink dark:text-white mb-8">
        {post.title}
      </h1>
      <div className="text-ink dark:text-gray-300 leading-relaxed">
        <ReactMarkdown>{post.content}</ReactMarkdown>
      </div>
    </article>
  );
}
```

### 4. 样式微调 (`src/app/globals.css`)

确保 CSS 能够支持 Tailwind 的全部功能：

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

/* 覆盖默认滚动条样式 (可选，为了极简) */
::-webkit-scrollbar {
  width: 6px;
}
::-webkit-scrollbar-track {
  background: transparent;
}
::-webkit-scrollbar-thumb {
  background: #e5e7eb;
  border-radius: 3px;
}
.dark ::-webkit-scrollbar-thumb {
  background: #333;
}
```

### 5. 内容填充与发布流程

1.  **添加文章:** 在 `posts/` 目录下创建文件，例如 `2024-05-20-gpt-coding.md`。
    ```markdown
    ---
    title: "GPT 关于代码重构的建议"
    date: "2024-05-20"
    ---

    这里是正文内容...
    ```

2.  **推送到 GitHub:**
    ```bash
    git init
    git add .
    git commit -m "Initial commit"
    git branch -M main
    git remote add origin https://github.com/jclio/ai_output_retention.git
    git push -u origin main
    ```

3.  **Cloudflare Pages 部署:**
    *   登录 Cloudflare Dashboard -> Pages。
    *   Connect to Git -> 选择 `ai_output_retention` 仓库。
    *   **Build settings:**
        *   **Framework preset:** Next.js (Static HTML Export)
        *   **Build command:** `npm run build` (或者 `npx next build`)
        *   **Output directory:** `out`
    *   点击 "Save and Deploy"。

### 6. 设计细节检查

*   **极简白色:** 默认背景 `bg-white`。
*   **深黑字体:** 自定义颜色 `ink: #1a1a1a`，避免纯黑 `#000` 造成的视觉疲劳，但在亮色模式下足够深。
*   **微软雅黑:** 已经在 `tailwind.config.js` 中将 `sans` 字体栈首选设为 "Microsoft YaHei"。
*   **首页逻辑:** `page.js` 直接读取了第一篇文章渲染，没有列表干扰，符合“首页即最新文章”。
*   **导航栏:** 位于底部 `fixed bottom-0`，两行布局，极简设计。
*   **暗亮切换:** 仅在右上角保留图标，不占空间。
